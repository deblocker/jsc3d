var JSC3D=JSC3D||{}
JSC3D.OpenCTMLoader=function(e,t,r,o){if(this.onload=e&&"function"==typeof e?e:null,this.onerror=t&&"function"==typeof t?t:null,this.onprogress=r&&"function"==typeof r?r:null,this.onresource=o&&"function"==typeof o?o:null,this.urlPath="",this.req=null,"ie"==JSC3D.PlatformInfo.browser&&parseInt(JSC3D.PlatformInfo.version)<11)throw JSC3D.console&&JSC3D.console.logError("CTM file loader is not supported on IE versions < 11."),"JSC3D.OpenCTMLoader constructor failed: This loader is not supported on IE versions < 11!"
if(!JSC3D.PlatformInfo.supportTypedArrays)throw JSC3D.console&&JSC3D.console.logError("CTM file loader is not supported on this browser. (Lacks support for typed arrays)"),"JSC3D.OpenCTMLoader constructor failed: This loader is not supported on this browser!"},JSC3D.OpenCTMLoader.prototype.loadFromUrl=function(e){var t=this,r="ie"==JSC3D.PlatformInfo.browser,o=!1,i=new XMLHttpRequest
i.open("GET",encodeURI(e),!0),o?i.responseType="blob":r?i.setRequestHeader("Accept-Charset","x-user-defined"):i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(){if(4==this.readyState){if(200==this.status||0==this.status){if(JSC3D.console&&JSC3D.console.logInfo('Finished loading CTM file "'+e+'".'),t.onload)if(t.onprogress&&t.onprogress("Loading CTM file ...",1),o){var i=new FileReader
i.onload=function(r){var o=new JSC3D.Scene
o.srcUrl=e
var i=e.replace(/^.*(\\|\/|\:)/,"")
o.name=i.substr(0,i.lastIndexOf("."))||i+"",t.parseCTM(o,r.target.result),t.onload(o)},i.readAsText(this.response,"x-user-defined")}else if(r){var s=new JSC3D.Scene
s.srcUrl=e
var n=e.replace(/^.*(\\|\/|\:)/,"")
s.name=n.substr(0,n.lastIndexOf("."))||n+""
try{t.parseCTM(s,JSC3D.Util.ieXHRResponseBodyToString(this.responseBody))}catch(a){}t.onload(s)}else{var s=new JSC3D.Scene,n=e.replace(/^.*(\\|\/|\:)/,"")
s.name=n.substr(0,n.lastIndexOf("."))||n+"",s.srcUrl=e,t.parseCTM(s,this.responseText),t.onload(s)}}else JSC3D.console&&JSC3D.console.logError('Failed to load CTM file "'+e+'".'),t.onerror&&t.onerror('Failed to load CTM file "'+e+'".')
t.request=null}},this.onprogress&&(this.onprogress("Loading CTM file ...",0),i.onprogress=function(e){t.onprogress("Loading CTM file ...",e.position/e.totalSize)}),this.request=i,i.send()},JSC3D.OpenCTMLoader.prototype.abort=function(){this.req&&(this.req.abort(),this.req=null)},JSC3D.OpenCTMLoader.prototype.parseCTM=function(e,t){var r=new JSC3D.CTM.File(new JSC3D.CTM.Stream(t)),o=new JSC3D.Mesh
e.name||"ctm"
o.indexBuffer=new Int32Array(4*r.body.indices.length/3)
for(var i=0,s=0,n=r.body.indices,a=n.length;a>i;i+=3,s+=4)o.indexBuffer[s]=n[i],o.indexBuffer[s+1]=n[i+1],o.indexBuffer[s+2]=n[i+2],o.indexBuffer[s+3]=-1
if(o.vertexBuffer=r.body.vertices,r.body.uvMaps&&r.body.uvMaps.length>0){var d=this,h=new JSC3D.Texture(r.body.uvMaps[0].name,function(){o.setTexture(this),d.onresource&&d.onresource(this),d.onresourcecomplete&&d.onresourcecomplete()})
h.createFromUrl(this.urlPath+r.body.uvMaps[0].filename),o.texCoordBuffer=r.body.uvMaps[0].uv
for(var i=1,a=o.texCoordBuffer.length;a>i;i+=2)o.texCoordBuffer[i]=1-o.texCoordBuffer[i]}o.isTrivial()||e.addChild(o)},JSC3D.OpenCTMLoader.prototype.onload=null,JSC3D.OpenCTMLoader.prototype.onerror=null,JSC3D.OpenCTMLoader.prototype.onprogress=null,JSC3D.OpenCTMLoader.prototype.onresource=null,JSC3D.LoaderSelector.registerLoader("ctm",JSC3D.OpenCTMLoader),function(e){var t=t||{}
t.CompressionMethod={RAW:5718354,MG1:3229517,MG2:3295053},t.Flags={NORMALS:1},t.File=function(e){this.load(e)},t.File.prototype.load=function(e){this.header=new t.FileHeader(e),this.body=new t.FileBody(this.header),this.getReader().read(e,this.body)},t.File.prototype.getReader=function(){var e
switch(this.header.compressionMethod){case t.CompressionMethod.RAW:e=new t.ReaderRAW
break
case t.CompressionMethod.MG1:e=new t.ReaderMG1
break
case t.CompressionMethod.MG2:e=new t.ReaderMG2}return e},t.FileHeader=function(e){e.readInt32(),this.fileFormat=e.readInt32(),this.compressionMethod=e.readInt32(),this.vertexCount=e.readInt32(),this.triangleCount=e.readInt32(),this.uvMapCount=e.readInt32(),this.attrMapCount=e.readInt32(),this.flags=e.readInt32(),this.comment=e.readString()},t.FileHeader.prototype.hasNormals=function(){return this.flags&t.Flags.NORMALS},t.FileBody=function(e){var t=3*e.triangleCount,r=3*e.vertexCount,o=e.hasNormals()?3*e.vertexCount:0,i=2*e.vertexCount,s=4*e.vertexCount,n=0,a=new ArrayBuffer(4*(t+r+o+i*e.uvMapCount+s*e.attrMapCount))
if(this.indices=new Uint32Array(a,0,t),this.vertices=new Float32Array(a,4*t,r),e.hasNormals()&&(this.normals=new Float32Array(a,4*(t+r),o)),e.uvMapCount)for(this.uvMaps=[],n=0;n<e.uvMapCount;++n)this.uvMaps[n]={uv:new Float32Array(a,4*(t+r+o+n*i),i)}
if(e.attrMapCount)for(this.attrMaps=[],n=0;n<e.attrMapCount;++n)this.attrMaps[n]={attr:new Float32Array(a,4*(t+r+o+i*e.uvMapCount+n*s),s)}},t.FileMG2Header=function(e){e.readInt32(),this.vertexPrecision=e.readFloat32(),this.normalPrecision=e.readFloat32(),this.lowerBoundx=e.readFloat32(),this.lowerBoundy=e.readFloat32(),this.lowerBoundz=e.readFloat32(),this.higherBoundx=e.readFloat32(),this.higherBoundy=e.readFloat32(),this.higherBoundz=e.readFloat32(),this.divx=e.readInt32(),this.divy=e.readInt32(),this.divz=e.readInt32(),this.sizex=(this.higherBoundx-this.lowerBoundx)/this.divx,this.sizey=(this.higherBoundy-this.lowerBoundy)/this.divy,this.sizez=(this.higherBoundz-this.lowerBoundz)/this.divz},t.ReaderRAW=function(){},t.ReaderRAW.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},t.ReaderRAW.prototype.readIndices=function(e,t){e.readInt32(),e.readArrayInt32(t)},t.ReaderRAW.prototype.readVertices=function(e,t){e.readInt32(),e.readArrayFloat32(t)},t.ReaderRAW.prototype.readNormals=function(e,t){e.readInt32(),e.readArrayFloat32(t)},t.ReaderRAW.prototype.readUVMaps=function(e,t){for(var r=0;r<t.length;++r)e.readInt32(),t[r].name=e.readString(),t[r].filename=e.readString(),e.readArrayFloat32(t[r].uv)},t.ReaderRAW.prototype.readAttrMaps=function(e,t){for(var r=0;r<t.length;++r)e.readInt32(),t[r].name=e.readString(),e.readArrayFloat32(t[r].attr)},t.ReaderMG1=function(){},t.ReaderMG1.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},t.ReaderMG1.prototype.readIndices=function(e,o){e.readInt32(),e.readInt32()
var i=new t.InterleavedStream(o,3)
r.decompress(e,e,i,i.data.length),t.restoreIndices(o,o.length)},t.ReaderMG1.prototype.readVertices=function(e,o){e.readInt32(),e.readInt32()
var i=new t.InterleavedStream(o,1)
r.decompress(e,e,i,i.data.length)},t.ReaderMG1.prototype.readNormals=function(e,o){e.readInt32(),e.readInt32()
var i=new t.InterleavedStream(o,3)
r.decompress(e,e,i,i.data.length)},t.ReaderMG1.prototype.readUVMaps=function(e,o){for(var i=0;i<o.length;++i){e.readInt32(),o[i].name=e.readString(),o[i].filename=e.readString(),e.readInt32()
var s=new t.InterleavedStream(o[i].uv,2)
r.decompress(e,e,s,s.data.length)}},t.ReaderMG1.prototype.readAttrMaps=function(e,o){for(var i=0;i<o.length;++i){e.readInt32(),o[i].name=e.readString(),e.readInt32()
var s=new t.InterleavedStream(o[i].attr,4)
r.decompress(e,e,s,s.data.length)}},t.ReaderMG2=function(){},t.ReaderMG2.prototype.read=function(e,r){this.MG2Header=new t.FileMG2Header(e),this.readVertices(e,r.vertices),this.readIndices(e,r.indices),r.normals&&this.readNormals(e,r),r.uvMaps&&this.readUVMaps(e,r.uvMaps),r.attrMaps&&this.readAttrMaps(e,r.attrMaps)},t.ReaderMG2.prototype.readVertices=function(e,o){e.readInt32(),e.readInt32()
var i=new t.InterleavedStream(o,3)
r.decompress(e,e,i,i.data.length)
var s=this.readGridIndices(e,o)
t.restoreVertices(o,this.MG2Header,s,this.MG2Header.vertexPrecision)},t.ReaderMG2.prototype.readGridIndices=function(e,o){e.readInt32(),e.readInt32()
var i=new Uint32Array(o.length/3),s=new t.InterleavedStream(i,1)
return r.decompress(e,e,s,s.data.length),t.restoreGridIndices(i,i.length),i},t.ReaderMG2.prototype.readIndices=function(e,o){e.readInt32(),e.readInt32()
var i=new t.InterleavedStream(o,3)
r.decompress(e,e,i,i.data.length),t.restoreIndices(o,o.length)},t.ReaderMG2.prototype.readNormals=function(e,o){e.readInt32(),e.readInt32()
var i=new t.InterleavedStream(o.normals,3)
r.decompress(e,e,i,i.data.length)
var s=t.calcSmoothNormals(o.indices,o.vertices)
t.restoreNormals(o.normals,s,this.MG2Header.normalPrecision)},t.ReaderMG2.prototype.readUVMaps=function(e,o){for(var i=0;i<o.length;++i){e.readInt32(),o[i].name=e.readString(),o[i].filename=e.readString()
var s=e.readFloat32()
e.readInt32()
var n=new t.InterleavedStream(o[i].uv,2)
r.decompress(e,e,n,n.data.length),t.restoreMap(o[i].uv,2,s)}},t.ReaderMG2.prototype.readAttrMaps=function(e,o){for(var i=0;i<o.length;++i){e.readInt32(),o[i].name=e.readString()
var s=e.readFloat32()
e.readInt32()
var n=new t.InterleavedStream(o[i].attr,4)
r.decompress(e,e,n,n.data.length),t.restoreMap(o[i].attr,4,s)}},t.restoreIndices=function(e,t){var r=3
for(t>0&&(e[2]+=e[0],e[1]+=e[0]);t>r;r+=3)e[r]+=e[r-3],e[r]===e[r-3]?e[r+1]+=e[r-2]:e[r+1]+=e[r],e[r+2]+=e[r]},t.restoreGridIndices=function(e,t){for(var r=1;t>r;++r)e[r]+=e[r-1]},t.restoreVertices=function(e,t,r,o){for(var i,s,n,a,d,h=new Uint32Array(e.buffer,e.byteOffset,e.length),c=t.divx,p=c*t.divy,l=2147483647,u=0,f=0,_=0,y=r.length;y>f;_+=3)n=i=r[f++],d=~~(n/p),n-=~~(d*p),a=~~(n/c),n-=~~(a*c),s=h[_],i===l&&(s+=u),e[_]=t.lowerBoundx+n*t.sizex+o*s,e[_+1]=t.lowerBoundy+a*t.sizey+o*h[_+1],e[_+2]=t.lowerBoundz+d*t.sizez+o*h[_+2],l=i,u=s},t.restoreNormals=function(e,t,r){for(var o,i,s,n,a,d,h,c,p,l,u=new Uint32Array(e.buffer,e.byteOffset,e.length),f=0,_=e.length,y=1.5707963267948966;_>f;f+=3)o=u[f]*r,i=u[f+1],0===i?(e[f]=t[f]*o,e[f+1]=t[f+1]*o,e[f+2]=t[f+2]*o):(s=4>=i?(u[f+2]-2)*y:(4*u[f+2]/i-2)*y,i*=r*y,n=o*Math.sin(i),a=n*Math.cos(s),d=n*Math.sin(s),h=o*Math.cos(i),p=t[f+1],c=t[f]-t[f+2],l=Math.sqrt(2*p*p+c*c),l>1e-20&&(c/=l,p/=l),e[f]=t[f]*h+(t[f+1]*p-t[f+2]*c)*d-p*a,e[f+1]=t[f+1]*h-(t[f+2]+t[f])*p*d+c*a,e[f+2]=t[f+2]*h+(t[f]*c+t[f+1]*p)*d+p*a)},t.restoreMap=function(e,t,r){for(var o,i,s,n=new Uint32Array(e.buffer,e.byteOffset,e.length),a=0,d=e.length;t>a;++a)for(o=0,s=a;d>s;s+=t)i=n[s],o+=1&i?-(i+1>>1):i>>1,e[s]=o*r},t.calcSmoothNormals=function(e,t){var r,o,i,s,n,a,d,h,c,p,l,u,f,_,y,m=new Float32Array(t.length)
for(_=0,y=e.length;y>_;)r=3*e[_++],o=3*e[_++],i=3*e[_++],d=t[o]-t[r],p=t[i]-t[r],h=t[o+1]-t[r+1],l=t[i+1]-t[r+1],c=t[o+2]-t[r+2],u=t[i+2]-t[r+2],s=h*u-c*l,n=c*p-d*u,a=d*l-h*p,f=Math.sqrt(s*s+n*n+a*a),f>1e-10&&(s/=f,n/=f,a/=f),m[r]+=s,m[r+1]+=n,m[r+2]+=a,m[o]+=s,m[o+1]+=n,m[o+2]+=a,m[i]+=s,m[i+1]+=n,m[i+2]+=a
for(_=0,y=m.length;y>_;_+=3)f=Math.sqrt(m[_]*m[_]+m[_+1]*m[_+1]+m[_+2]*m[_+2]),f>1e-10&&(m[_]/=f,m[_+1]/=f,m[_+2]/=f)
return m},t.isLittleEndian=function(){try{var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e)
return t[0]=1,1===r[0]}catch(o){return!0}}(),t.InterleavedStream=function(e,r){this.data=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.offset=t.isLittleEndian?3:0,this.count=4*r,this.len=this.data.length},t.InterleavedStream.prototype.writeByte=function(e){this.data[this.offset]=e,this.offset+=this.count,this.offset>=this.len&&(this.offset-=this.len-4,this.offset>=this.count&&(this.offset-=this.count+(t.isLittleEndian?1:-1)))},t.Stream=function(e){this.data=e,this.offset=0},t.Stream.prototype.TWO_POW_MINUS23=Math.pow(2,-23),t.Stream.prototype.TWO_POW_MINUS126=Math.pow(2,-126),t.Stream.prototype.readByte=function(){return 255&this.data.charCodeAt(this.offset++)},t.Stream.prototype.readInt32=function(){var e=this.readByte()
return e|=this.readByte()<<8,e|=this.readByte()<<16,e|this.readByte()<<24},t.Stream.prototype.readFloat32=function(){var e=this.readByte()
e+=this.readByte()<<8
var t=this.readByte(),r=this.readByte()
e+=(127&t)<<16
var o=(127&r)<<1|(128&t)>>>7,i=128&r?-1:1
return 255===o?0!==e?NaN:i*(1/0):o>0?i*(1+e*this.TWO_POW_MINUS23)*Math.pow(2,o-127):0!==e?i*e*this.TWO_POW_MINUS126:0*i},t.Stream.prototype.readString=function(){var e=this.readInt32()
return this.offset+=e,this.data.substr(this.offset-e,e)},t.Stream.prototype.readArrayInt32=function(e){for(var t=0,r=e.length;r>t;)e[t++]=this.readInt32()
return e},t.Stream.prototype.readArrayFloat32=function(e){for(var t=0,r=e.length;r>t;)e[t++]=this.readFloat32()
return e}
var r=r||{}
r.OutWindow=function(){this._windowSize=0},r.OutWindow.prototype.create=function(e){this._buffer&&this._windowSize===e||(this._buffer=[]),this._windowSize=e,this._pos=0,this._streamPos=0},r.OutWindow.prototype.flush=function(){var e=this._pos-this._streamPos
if(0!==e){for(;e--;)this._stream.writeByte(this._buffer[this._streamPos++])
this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},r.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},r.OutWindow.prototype.setStream=function(e){this.releaseStream(),this._stream=e},r.OutWindow.prototype.init=function(e){e||(this._streamPos=0,this._pos=0)},r.OutWindow.prototype.copyBlock=function(e,t){var r=this._pos-e-1
for(0>r&&(r+=this._windowSize);t--;)r>=this._windowSize&&(r=0),this._buffer[this._pos++]=this._buffer[r++],this._pos>=this._windowSize&&this.flush()},r.OutWindow.prototype.putByte=function(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()},r.OutWindow.prototype.getByte=function(e){var t=this._pos-e-1
return 0>t&&(t+=this._windowSize),this._buffer[t]},r.RangeDecoder=function(){},r.RangeDecoder.prototype.setStream=function(e){this._stream=e},r.RangeDecoder.prototype.releaseStream=function(){this._stream=null},r.RangeDecoder.prototype.init=function(){var e=5
for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()},r.RangeDecoder.prototype.decodeDirectBits=function(e){for(var t,r=0,o=e;o--;)this._range>>>=1,t=this._code-this._range>>>31,this._code-=this._range&t-1,r=r<<1|1-t,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8)
return r},r.RangeDecoder.prototype.decodeBit=function(e,t){var r=e[t],o=(this._range>>>11)*r
return(2147483648^this._code)<(2147483648^o)?(this._range=o,e[t]+=2048-r>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=o,this._code-=o,e[t]-=r>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},r.initBitModels=function(e,t){for(;t--;)e[t]=1024},r.BitTreeDecoder=function(e){this._models=[],this._numBitLevels=e},r.BitTreeDecoder.prototype.init=function(){r.initBitModels(this._models,1<<this._numBitLevels)},r.BitTreeDecoder.prototype.decode=function(e){for(var t=1,r=this._numBitLevels;r--;)t=t<<1|e.decodeBit(this._models,t)
return t-(1<<this._numBitLevels)},r.BitTreeDecoder.prototype.reverseDecode=function(e){for(var t,r=1,o=0,i=0;i<this._numBitLevels;++i)t=e.decodeBit(this._models,r),r=r<<1|t,o|=t<<i
return o},r.reverseDecode2=function(e,t,r,o){for(var i,s=1,n=0,a=0;o>a;++a)i=r.decodeBit(e,t+s),s=s<<1|i,n|=i<<a
return n},r.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new r.BitTreeDecoder(8),this._numPosStates=0},r.LenDecoder.prototype.create=function(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new r.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new r.BitTreeDecoder(3)},r.LenDecoder.prototype.init=function(){var e=this._numPosStates
for(r.initBitModels(this._choice,2);e--;)this._lowCoder[e].init(),this._midCoder[e].init()
this._highCoder.init()},r.LenDecoder.prototype.decode=function(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)},r.Decoder2=function(){this._decoders=[]},r.Decoder2.prototype.init=function(){r.initBitModels(this._decoders,768)},r.Decoder2.prototype.decodeNormal=function(e){var t=1
do t=t<<1|e.decodeBit(this._decoders,t)
while(256>t)
return 255&t},r.Decoder2.prototype.decodeWithMatchByte=function(e,t){var r,o,i=1
do if(r=t>>7&1,t<<=1,o=e.decodeBit(this._decoders,(1+r<<8)+i),i=i<<1|o,r!==o){for(;256>i;)i=i<<1|e.decodeBit(this._decoders,i)
break}while(256>i)
return 255&i},r.LiteralDecoder=function(){},r.LiteralDecoder.prototype.create=function(e,t){var o
if(!this._coders||this._numPrevBits!==t||this._numPosBits!==e)for(this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[],o=1<<this._numPrevBits+this._numPosBits;o--;)this._coders[o]=new r.Decoder2},r.LiteralDecoder.prototype.init=function(){for(var e=1<<this._numPrevBits+this._numPosBits;e--;)this._coders[e].init()},r.LiteralDecoder.prototype.getDecoder=function(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]},r.Decoder=function(){this._outWindow=new r.OutWindow,this._rangeDecoder=new r.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new r.BitTreeDecoder(4),this._lenDecoder=new r.LenDecoder,this._repLenDecoder=new r.LenDecoder,this._literalDecoder=new r.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new r.BitTreeDecoder(6),this._posSlotDecoder[1]=new r.BitTreeDecoder(6),this._posSlotDecoder[2]=new r.BitTreeDecoder(6),this._posSlotDecoder[3]=new r.BitTreeDecoder(6)},r.Decoder.prototype.setDictionarySize=function(e){return 0>e?!1:(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},r.Decoder.prototype.setLcLpPb=function(e,t,r){var o=1<<r
return e>8||t>4||r>4?!1:(this._literalDecoder.create(t,e),this._lenDecoder.create(o),this._repLenDecoder.create(o),this._posStateMask=o-1,!0)},r.Decoder.prototype.init=function(){var e=4
for(this._outWindow.init(!1),r.initBitModels(this._isMatchDecoders,192),r.initBitModels(this._isRep0LongDecoders,192),r.initBitModels(this._isRepDecoders,12),r.initBitModels(this._isRepG0Decoders,12),r.initBitModels(this._isRepG1Decoders,12),r.initBitModels(this._isRepG2Decoders,12),r.initBitModels(this._posDecoders,114),this._literalDecoder.init();e--;)this._posSlotDecoder[e].init()
this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},r.Decoder.prototype.decode=function(e,t,o){var i,s,n,a,d,h,c=0,p=0,l=0,u=0,f=0,_=0,y=0
for(this._rangeDecoder.setStream(e),this._outWindow.setStream(t),this.init();0>o||o>_;)if(i=_&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(c<<4)+i))s=this._literalDecoder.getDecoder(_++,y),y=c>=7?s.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(p)):s.decodeNormal(this._rangeDecoder),this._outWindow.putByte(y),c=4>c?0:c-(10>c?3:6)
else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,c))n=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,c)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(c<<4)+i)&&(c=7>c?9:11,n=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,c)?a=l:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,c)?a=u:(a=f,f=u),u=l),l=p,p=a),0===n&&(n=2+this._repLenDecoder.decode(this._rangeDecoder,i),c=7>c?8:11)
else if(f=u,u=l,l=p,n=2+this._lenDecoder.decode(this._rangeDecoder,i),c=7>c?7:10,d=this._posSlotDecoder[5>=n?n-2:3].decode(this._rangeDecoder),d>=4){if(h=(d>>1)-1,p=(2|1&d)<<h,14>d)p+=r.reverseDecode2(this._posDecoders,p-d-1,this._rangeDecoder,h)
else if(p+=this._rangeDecoder.decodeDirectBits(h-4)<<4,p+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>p){if(-1===p)break
return!1}}else p=d
if(p>=_||p>=this._dictionarySizeCheck)return!1
this._outWindow.copyBlock(p,n),_+=n,y=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},r.Decoder.prototype.setDecoderProperties=function(e){var t,r,o,i,s
return e.size<5?!1:(t=e.readByte(),r=t%9,t=~~(t/9),o=t%5,i=~~(t/5),this.setLcLpPb(r,o,i)?(s=e.readByte(),s|=e.readByte()<<8,s|=e.readByte()<<16,s+=16777216*e.readByte(),this.setDictionarySize(s)):!1)},r.decompress=function(e,t,o,i){var s=new r.Decoder
if(!s.setDecoderProperties(e))throw"Incorrect stream properties"
if(!s.decode(t,o,i))throw"Error in data stream"
return!0},e.CTM=t}(JSC3D)